/*
 * Tables (gridlines / wrapping / per-note modifiers) + PDF/print fix
 * - Reading view: .markdown-preview-view
 * - Live Preview: .markdown-source-view.mod-cm6 .markdown-rendered
 */

/*
 * Table borders (vertical/horizontal gridlines)
 * Some themes may show only horizontal rules by default.
 * This forces gridlines so pasted HTML tables keep visible borders.
 */
:is(.markdown-preview-view, .markdown-source-view.mod-cm6 .markdown-rendered) table {
  border-collapse: collapse;
  font-size: 0.9em;
  line-height: 1.35;
  max-width: 100%;
}

:is(.markdown-preview-view, .markdown-source-view.mod-cm6 .markdown-rendered) table :is(th, td) {
  border: 1px solid var(--background-modifier-border) !important;
  padding: 0.4em 0.6em;
}

/* Horizontal scroll only (no vertical scrolling / no height constraint) */
:is(.markdown-preview-view, .markdown-source-view.mod-cm6 .markdown-rendered) .table-wrapper {
  overflow-x: auto !important;
  overflow-y: hidden !important;
  max-height: none !important;
}

/* Default: allow wrapping in table cells */
:is(.markdown-preview-view, .markdown-source-view.mod-cm6 .markdown-rendered) table td {
  white-space: normal;
  overflow-wrap: break-word;
  word-break: normal;
}

/* Optional: per-note switch (frontmatter cssclasses: [table-nowrap]) */
:is(
  /* Reading view: class is often applied on the preview root */
  .markdown-preview-view.table-nowrap,
  /* Reading view fallback: class may be applied above the preview root */
  .table-nowrap .markdown-preview-view,
  /* Live Preview: class is typically applied on the source view root */
  .markdown-source-view.mod-cm6.table-nowrap .markdown-rendered,
  /* Live Preview fallback: class may be applied above the source view */
  .table-nowrap .markdown-source-view.mod-cm6 .markdown-rendered
) table :is(th, td) {
  white-space: nowrap !important;
  word-break: keep-all !important;
  overflow-wrap: normal !important;
}

/* Editor (Source mode) markdown tables: prevent wrapping of table rows */
.markdown-source-view.mod-cm6.table-nowrap .cm-line.HyperMD-table-row,
.markdown-source-view.mod-cm6.table-nowrap .HyperMD-table-row,
.table-nowrap .markdown-source-view.mod-cm6 .cm-line.HyperMD-table-row,
.table-nowrap .markdown-source-view.mod-cm6 .HyperMD-table-row {
  white-space: pre !important;
}

.markdown-source-view.mod-cm6.table-nowrap .cm-scroller,
.table-nowrap .markdown-source-view.mod-cm6 .cm-scroller {
  overflow-x: auto !important;
}

/* In nowrap tables, default links to ellipsis (URLs get too long otherwise) */
:is(
  .markdown-preview-view.table-nowrap,
  .table-nowrap .markdown-preview-view,
  .markdown-source-view.mod-cm6.table-nowrap .markdown-rendered,
  .table-nowrap .markdown-source-view.mod-cm6 .markdown-rendered
) table :is(th, td) a {
  display: inline-block;
  max-width: 28ch;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap !important;
  vertical-align: bottom;
}

/* Optional: per-note switch to WRAP links instead (cssclasses: [table-nowrap, table-link-wrap]) */
:is(
  .markdown-preview-view.table-link-wrap,
  .table-link-wrap .markdown-preview-view,
  .markdown-source-view.mod-cm6.table-link-wrap .markdown-rendered,
  .table-link-wrap .markdown-source-view.mod-cm6 .markdown-rendered
) table :is(th, td) a {
  display: inline;
  max-width: none;
  overflow: visible;
  text-overflow: clip;
  white-space: normal !important;
  overflow-wrap: anywhere !important;
  word-break: break-word !important;
}

/* Consistent header background */
:is(.markdown-preview-view, .markdown-source-view.mod-cm6 .markdown-rendered) table thead :is(tr, th) {
  background-color: var(--background-secondary) !important;
  background-image: none !important;
}

/*
 * PDF/印刷で表の右端が切れる対策
 * - print時は横スクロールできないため、overflowを解除して折り返しを優先
 * - cssclasses: [table-nowrap] を使っているノートでも、印刷時は折り返しを優先
 */
@media print {
  /* table-wrapperをページ幅に収める */
  .table-wrapper {
    overflow: visible !important;
    max-height: none !important;
    width: 100% !important;
    max-width: 100% !important;
    display: block !important;
    box-sizing: border-box !important;
  }

  /* テーブル本体 - ランドスケープ前提で読みやすいサイズ */
  table {
    width: 100% !important;
    max-width: 100% !important;
    table-layout: fixed !important;
    font-size: 8pt !important;
    line-height: 1.3 !important;
    box-sizing: border-box !important;
    border-spacing: 0 !important;
    border-collapse: collapse !important;
  }

  table :is(th, td) {
    white-space: normal !important;
    overflow-wrap: anywhere !important;
    word-break: break-all !important;
    padding: 2pt 3pt !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
    font-size: 8pt !important;
  }

  table :is(th, td) a {
    display: inline !important;
    max-width: none !important;
    overflow: visible !important;
    text-overflow: clip !important;
    white-space: normal !important;
    overflow-wrap: anywhere !important;
    word-break: break-all !important;
  }

  :is(.markdown-preview-view, .markdown-source-view.mod-cm6 .markdown-rendered) table tr {
    break-inside: avoid;
    page-break-inside: avoid;
  }
}





